# ============================================================================
# Traefik Dynamic Configuration - Middlewares
# ============================================================================
# This file defines reusable middlewares for Traefik
# Auto-loaded when placed in the dynamic configuration directory
#
# Generated by: Chezmoi
# Tenant: {{ .tenant.name }}
# ============================================================================

http:
  middlewares:
    # Security headers middleware
    security-headers:
      headers:
        frameDeny: true
        browserXssFilter: true
        contentTypeNosniff: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        customFrameOptionsValue: "SAMEORIGIN"

    # Compression middleware
    compression:
      compress: {}

    # Rate limiting middleware (general)
    rate-limit:
      rateLimit:
        average: 100
        burst: 50
        period: 1s

    # Rate limiting middleware (strict)
    rate-limit-strict:
      rateLimit:
        average: 10
        burst: 5
        period: 1s

    # Redirect www to non-www
    redirect-www:
      redirectRegex:
        regex: "^https://www\\.(.+)"
        replacement: "https://${1}"
        permanent: true

    # IP whitelist for admin panels (example)
    # admin-whitelist:
    #   ipWhiteList:
    #     sourceRange:
    #       - "127.0.0.1/32"
    #       - "192.168.1.0/24"

    # Basic auth (alternative to labels)
    # admin-auth:
    #   basicAuth:
    #     users:
    #       - "admin:$apr1$H6usRDpK$6r.F8bjNxZ3W9YfNd5V9c1"
