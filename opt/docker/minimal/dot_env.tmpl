# ============================================================================
# Environment Configuration - Managed by Chezmoi
# ============================================================================
# Tenant: {{ .tenant.name }}
# Domain: {{ .tenant.domain }}
# Generated: {{ now | date "2006-01-02 15:04:05 MST" }}
#
# WARNING: This file is automatically generated by Chezmoi.
# Manual changes will be overwritten on next deployment.
# To modify, edit the Chezmoi template or tenant configuration.
# ============================================================================

# ============================================================================
# GLOBAL SETTINGS
# ============================================================================

DOMAIN={{ .tenant.domain }}
TIMEZONE={{ .deployment.timezone }}

# ============================================================================
# TRAEFIK - Reverse Proxy
# ============================================================================

{{- $services := .services | default (dict) -}}

{{- if index $services "traefik" }}
{{- if (index $services "traefik").enabled }}
{{- $traefik := index $services "traefik" }}
TRAEFIK_ACME_EMAIL={{ $traefik.options.TRAEFIK_ACME_EMAIL | default (printf "admin@%s" .tenant.domain) }}
{{- end }}
{{- end }}

# ============================================================================
# AUTHENTIK - Identity Provider
# ============================================================================

{{- if index $services "authentik" }}
{{- if (index $services "authentik").enabled }}
{{- $authentik := index $services "authentik" }}
AUTHENTIK_DB_USER={{ $authentik.options.AUTHENTIK_DB_USER | default "authentik" }}
AUTHENTIK_DB_PASSWORD={{ $authentik.options.AUTHENTIK_DB_PASSWORD | default "CHANGE_ME_GENERATE_SECURE_PASSWORD" }}
AUTHENTIK_SECRET_KEY={{ $authentik.options.AUTHENTIK_SECRET_KEY | default "CHANGE_ME_GENERATE_SECURE_60_BYTE_SECRET" }}

# SMTP Configuration (Optional)
{{- if $authentik.options.SMTP_HOST }}
SMTP_HOST={{ $authentik.options.SMTP_HOST }}
SMTP_PORT={{ $authentik.options.SMTP_PORT | default "587" }}
SMTP_USERNAME={{ $authentik.options.SMTP_USERNAME }}
SMTP_PASSWORD={{ $authentik.options.SMTP_PASSWORD }}
SMTP_FROM={{ $authentik.options.SMTP_FROM }}
{{- end }}
{{- end }}
{{- end }}

# ============================================================================
# IMMICH - Photo Management
# ============================================================================

{{- if index $services "immich" }}
{{- if (index $services "immich").enabled }}
{{- $immich := index $services "immich" }}
IMMICH_VERSION={{ $immich.options.IMMICH_VERSION | default "v2" }}
DB_USERNAME={{ $immich.options.DB_USERNAME | default "postgres" }}
DB_PASSWORD={{ $immich.options.DB_PASSWORD | default "CHANGE_ME_GENERATE_SECURE_PASSWORD" }}
DB_DATABASE_NAME={{ $immich.options.DB_DATABASE_NAME | default "immich" }}
UPLOAD_LOCATION={{ $immich.options.UPLOAD_LOCATION | default "./library" }}
DB_DATA_LOCATION={{ $immich.options.DB_DATA_LOCATION | default "./postgres" }}

{{- if $immich.options.IMMICH_MEDIA_PATH }}
IMMICH_MEDIA_PATH={{ $immich.options.IMMICH_MEDIA_PATH }}
{{- end }}
{{- if $immich.options.IMMICH_TRANSCODING_PRESET }}
IMMICH_TRANSCODING_PRESET={{ $immich.options.IMMICH_TRANSCODING_PRESET }}
{{- end }}
{{- if $immich.options.IMMICH_ML_PRESET }}
IMMICH_ML_PRESET={{ $immich.options.IMMICH_ML_PRESET }}
{{- end }}
{{- end }}
{{- end }}

# ============================================================================
# JELLYFIN - Media Server
# ============================================================================

{{- if index $services "jellyfin" }}
{{- if (index $services "jellyfin").enabled }}
{{- $jellyfin := index $services "jellyfin" }}
JELLYFIN_PUID={{ $jellyfin.options.JELLYFIN_PUID | default "1000" }}
JELLYFIN_PGID={{ $jellyfin.options.JELLYFIN_PGID | default "1000" }}
JELLYFIN_MEDIA_MOVIES={{ $jellyfin.options.JELLYFIN_MEDIA_MOVIES | default "./media/movies" }}
JELLYFIN_MEDIA_TV={{ $jellyfin.options.JELLYFIN_MEDIA_TV | default "./media/tv" }}
JELLYFIN_MEDIA_MUSIC={{ $jellyfin.options.JELLYFIN_MEDIA_MUSIC | default "./media/music" }}
{{- end }}
{{- end }}

# ============================================================================
# GITEA - Git Hosting
# ============================================================================

{{- if index $services "gitea" }}
{{- if (index $services "gitea").enabled }}
{{- $gitea := index $services "gitea" }}
GITEA_UID={{ $gitea.options.GITEA_UID | default "1000" }}
GITEA_GID={{ $gitea.options.GITEA_GID | default "1000" }}
GITEA_DISABLE_REGISTRATION={{ $gitea.options.GITEA_DISABLE_REGISTRATION | default "false" }}
GITEA_REQUIRE_SIGNIN={{ $gitea.options.GITEA_REQUIRE_SIGNIN | default "false" }}
{{- end }}
{{- end }}

# ============================================================================
# VAULTWARDEN - Password Manager
# ============================================================================

{{- if index $services "vaultwarden" }}
{{- if (index $services "vaultwarden").enabled }}
{{- $vaultwarden := index $services "vaultwarden" }}
VAULTWARDEN_ADMIN_TOKEN={{ $vaultwarden.options.VAULTWARDEN_ADMIN_TOKEN | default "CHANGE_ME_GENERATE_SECURE_ADMIN_TOKEN" }}
VAULTWARDEN_SIGNUPS_ALLOWED={{ $vaultwarden.options.VAULTWARDEN_SIGNUPS_ALLOWED | default "true" }}
VAULTWARDEN_DOMAIN={{ $vaultwarden.options.VAULTWARDEN_DOMAIN | default (printf "https://vault.%s" .tenant.domain) }}
{{- end }}
{{- end }}

# ============================================================================
# NEXTCLOUD - File Sync and Storage
# ============================================================================

{{- if index $services "nextcloud" }}
{{- if (index $services "nextcloud").enabled }}
{{- $nextcloud := index $services "nextcloud" }}
NEXTCLOUD_ADMIN_USER={{ $nextcloud.options.NEXTCLOUD_ADMIN_USER | default "admin" }}
NEXTCLOUD_ADMIN_PASSWORD={{ $nextcloud.options.NEXTCLOUD_ADMIN_PASSWORD | default "CHANGE_ME_GENERATE_SECURE_PASSWORD" }}
NEXTCLOUD_DB_USER={{ $nextcloud.options.NEXTCLOUD_DB_USER | default "nextcloud" }}
NEXTCLOUD_DB_PASSWORD={{ $nextcloud.options.NEXTCLOUD_DB_PASSWORD | default "CHANGE_ME_GENERATE_SECURE_PASSWORD" }}

{{- if $nextcloud.options.NEXTCLOUD_DATA_PATH }}
NEXTCLOUD_DATA_PATH={{ $nextcloud.options.NEXTCLOUD_DATA_PATH }}
{{- end }}
{{- end }}
{{- end }}

# ============================================================================
# HOMEPAGE - Dashboard
# ============================================================================

{{- if index $services "homepage" }}
{{- if (index $services "homepage").enabled }}
{{- $homepage := index $services "homepage" }}
HOMEPAGE_PUID={{ $homepage.options.HOMEPAGE_PUID | default "1000" }}
HOMEPAGE_PGID={{ $homepage.options.HOMEPAGE_PGID | default "1000" }}
HOMEPAGE_VAR_DOMAIN={{ .tenant.domain }}
{{- end }}
{{- end }}

# ============================================================================
# TAILSCALE - VPN Mesh Network
# ============================================================================

{{- if index $services "tailscale" }}
{{- if (index $services "tailscale").enabled }}
{{- $tailscale := index $services "tailscale" }}
TAILSCALE_AUTHKEY={{ $tailscale.options.TAILSCALE_AUTHKEY | default "your-tailscale-auth-key" }}
TAILSCALE_HOSTNAME={{ $tailscale.options.TAILSCALE_HOSTNAME | default .tenant.name }}
{{- end }}
{{- end }}

# ============================================================================
# Generated by Chezmoi Configuration Management
# Chezmoi Source: {{ .chezmoi.sourceDir }}
# Target Hostname: {{ .chezmoi.hostname }}
# ============================================================================
